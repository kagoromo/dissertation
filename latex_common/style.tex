%% Assorted style and presentation stuff.

\newcommand{\figsepr}{\vspace{0.5em}\hrulefill\vspace{0.5em}}
\newcommand{\etal}{\textit{et al}.}
\newcommand{\ie}{\textit{i}.\textit{e}.}
\newcommand{\eg}{\textit{e}.\textit{g}.}
\newcommand{\il}[1]{\lstinline{#1}}

%% LK: See the definition of `\theequation`.
\newcommand{\eref}[1]{\ref{#1}}

%====Set up Listings===============================================================

\definecolor{darkgreen}{rgb}{0,0.5,0}
\definecolor{darkred}{rgb}{0.5,0,0}
\lstloadlanguages{Haskell}
\lstnewenvironment{code}
    { % \centering
      \lstset{}%
      \csname lst@SetFirstLabel\endcsname}
    { %\centering
      \csname lst@SaveFirstLabel\endcsname}
    \lstset{
      language=Haskell,
%      basicstyle=\footnotesize\ttfamily,
      basicstyle=\small\ttfamily,
      flexiblecolumns=false,
      basewidth={0.5em,0.45em},
      aboveskip={3pt},
      belowskip={3pt},
      keywordstyle=\color{blue},  
      commentstyle=\color{darkgreen},
      % Ugh, it keywords map/sort/zipWith.  Should do this for
      % consistency or figure out how to DISABLE those other keywords:
      morekeywords={fold,foldSeg,permute,scan,scanl},
      literate={+}{{$+$}}1 {/}{{$/$}}1 {*}{{$*$}}1 % {=}{{$=$}}1
               {>}{{$>$}}1 {<}{{$<$}}1 {\\}{{$\lambda$}}1
               {\\\\}{{\char`\\\char`\\}}1
               {->}{{$\rightarrow$}}2 {>=}{{$\geq$}}2 {<-}{{$\leftarrow$}}2
               {<=}{{$\leq$}}2 {=>}{{$\Rightarrow$}}2 
               {\ .}{{$\circ$}}2 {\ .\ }{{$\circ$}}2
               {>>}{{>>}}2 {>>=}{{>>=}}2 {=<<}{{=<<}}2
               {|}{{$\mid$}}1
               {`member`}{{$\in$}}1
               {leftBrace}{\{}1
               {rightBrace}{\}}1
               {\$singleton\$startV}{{ \hspace{2.4em} \{{\tt startV}\}}}1
               {\$singleton\$n}{{  \{{\tt n}\}}}1
               {dotdotdot}{{$\ldots$}}3
    }

%================================================================================

% Penalty for line-breaking inline math
\relpenalty=9999
\binoppenalty=9999

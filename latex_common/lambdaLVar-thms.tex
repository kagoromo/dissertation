\newcommand{\LVarsLemPermutability}{
\begin{lem}[Permutability]\label{lem:lvars-permutability}
  For any finite permutation $\pi$,
  \begin{enumerate}
  \item \label{thm:permutable-reduction-transitions} $\conf
    \parstepsto \conf'$ if and only if $\pi(\conf) \parstepsto
    \pi(\conf')$.
  \item \label{thm:permutable-context-transitions} $\conf \ctxstepsto
    \conf'$ if and only if $\pi(\conf) \ctxstepsto \pi(\conf')$.
  \end{enumerate}
\end{lem}
}

\newcommand{\LVarsLemInternalDeterminism}{
\begin{lem}[Internal Determinism of the Reduction Semantics]\label{lem:lvars-internal-determinism}
  If $\conf \parstepsto \conf'$ and $\conf \parstepsto \conf''$, then
  there is a permutation $\pi$ such that $\conf' = \pi(\conf'')$.
\end{lem}
}

\newcommand{\LVarsLemLocality}{
\begin{lem}[Locality]\label{lem:lvars-locality}
  If $\config{S}{\evalctxt{E_1}{e_1}} \ctxstepsto
  \config{S_1}{\evalctxt{E_1}{e'_1}}$ and
  $\config{S}{\evalctxt{E_2}{e_2}} \ctxstepsto
  \config{S_2}{\evalctxt{E_2}{e'_2}}$ and $\evalctxt{E_1}{e_1} =
  \evalctxt{E_2}{e_2}$, then there exist evaluation contexts $E'_1$
  and $E'_2$ such that:
  \begin{itemize}
  \item $\evalctxt{E'_1}{e_1} = \evalctxt{E_2}{e'_2}$, and
  \item $\evalctxt{E'_2}{e_2} = \evalctxt{E_1}{e'_1}$, and
  \item $\evalctxt{E'_1}{e'_1} = \evalctxt{E'_2}{e'_2}$.
  \end{itemize}
\end{lem}
}

\newcommand{\LVarsLemMonotonicity}{
\begin{lem}[Monotonicity]\label{lem:lvars-monotonicity}
  If $\config{S}{e} \parstepsto \config{S'}{e'}$, then
  $\leqstore{S}{S'}$.
\end{lem}
}

\newcommand{\LVarsLemIndependence}{
\begin{lem}[Independence]\label{lem:lvars-independence}
  If $\config{S}{e} \parstepsto \config{S'}{e'}$ (where
  $\config{S'}{e'} \neq \textup{\error}$), then for all $S''$ such
  that $S''$ is non-conflicting with $\config{S}{e} \parstepsto
  \config{S'}{e'}$ and $\lubstore{S'}{S''} \neq \topS$:

  $\config{\lubstore{S}{S''}}{e} \parstepsto \config{\lubstore{S'}{S''}}{e'}$.
\end{lem}
}

\newcommand{\LVarsLemClash}{
\begin{lem}[Clash]\label{lem:lvars-clash}
  If $\config{S}{e} \parstepsto \config{S'}{e'}$ (where
  $\config{S'}{e'} \neq \textup{\error}$), then for all $S''$ such
  that $S''$ is non-conflicting with $\config{S}{e} \parstepsto
  \config{S'}{e'}$ and $\lubstore{S'}{S''} = \topS$:

  $\config{\lubstore{S}{S''}}{e} \parstepsto^i \textup{\error}$, where
  $i \leq 1$.
\end{lem}
}

\newcommand{\LemStorePartition}{
\begin{lem}[Store Partition]\label{lem:store-partition}
  Let $S$ and $S'$ be stores.  Then, for all $l_i$ such that $S(l_i)
  \mylt S'(l_i)$, there exists $S''$ such that
  $\eqstore{S'}{\extS{S''}{l_i}{S'(l_i)}}$ and $\myltstore{S''}{S'}$.
\end{lem}
}

\newcommand{\LVarsLemErrorPreservation}{
\begin{lem}[Error Preservation]\label{lem:lvars-error-preservation}
  If $\config{S}{e} \parstepsto \textup{\error}$ and $\leqstore{S}{S'}$, then
  $\config{S'}{e} \parstepsto \textup{\error}$.
\end{lem}
}

\newcommand{\LVarsLemStrongLocalConfluence}{
\begin{lem}[Strong Local Confluence]\label{lem:lvars-strong-local-confluence}
  If $\conf \ctxstepsto \conf_a$ and $\conf \ctxstepsto \conf_b$, then
  there exist $\conf_c, i, j, \pi$ such that $\conf_a \ctxstepsto^i
  \conf_c$ and $\pi(\conf_b) \ctxstepsto^j \conf_c$ and $i \leq
  1$ and $j \leq 1$.
\end{lem}
}

\newcommand{\LVarsLemStrongOneSidedConfluence}{
\begin{lem}[Strong One-Sided Confluence]\label{lem:lvars-strong-one-sided-confluence}
  If $\conf \ctxstepsto \conf'$ and $\conf \ctxstepsto^m \conf''$,
  where $1 \leq m$, then there exist $\conf_c, i, j, \pi$ such that
  $\conf' \ctxstepsto^i \conf_c$ and $\pi(\conf'') \ctxstepsto^j
  \conf_c$ and $i \leq m$ and $j \leq 1$.
\end{lem}
}

\newcommand{\LVarsLemStrongConfluence}{
\begin{lem}[Strong Confluence]\label{lem:lvars-strong-confluence}
  If $\conf \ctxstepsto^n \conf'$ and $\conf \ctxstepsto^m \conf''$,
  where $1 \leq n$ and $1 \leq m$, then there exist $\conf_c, i, j,
  \pi$ such that $\conf' \ctxstepsto^i \conf_c$ and $\pi(\conf'')
  \ctxstepsto^j \conf_c$ and $i \leq m$ and $j \leq n$.
\end{lem}
}

\newcommand{\LVarsLemConfluence}{
\begin{lem}[Confluence]\label{lem:lvars-confluence}
  If $\conf \ctxstepsto^* \conf'$ and $\conf \ctxstepsto^* \conf''$,
  then there exist $\conf_c$ and $\pi$ such that $\conf' \ctxstepsto^*
  \conf_c$ and $\pi(\conf'') \ctxstepsto^* \conf_c$.
\end{lem}
\begin{proof}
  Strong Confluence (Lemma~\ref{lem:lvars-strong-confluence}) implies
  Confluence.
\end{proof}
}

\newcommand{\LVarsThmDeterminism}{
\begin{thm}[Determinism]\label{thm:lvars-determinism}
  If $\conf \ctxstepsto^* \conf'$ and $\conf \ctxstepsto^* \conf''$,
  and neither $\conf'$ nor $\conf''$ can take a step, then there
  exists $\pi$ such that $\conf' = \pi(\conf'')$.
\end{thm}
\begin{proof}
  We have from Lemma~\ref{lem:lvars-confluence} that there exists
  $\conf_c$ and $\pi$ such that $\conf' \ctxstepsto^* \conf_c$ and
  $\pi(\conf'') \ctxstepsto^* \conf_c$.  Since $\conf'$ cannot step,
  we must have $\conf' = \conf_c$.

  By Lemma~\ref{lem:lvars-permutability} (Permutability), $\conf''$
  can step iff $\pi(\conf'')$ can step, so since $\conf''$ cannot
  step, $\pi(\conf'')$ cannot step either.

  Hence we must have $\pi(\conf'') = \conf_c$.  Since $\conf' =
  \conf_c$ and $\pi(\conf'') = \conf_c$, $\conf' = \pi(\conf'')$.
\end{proof}
}

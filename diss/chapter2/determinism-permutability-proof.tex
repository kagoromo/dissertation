\begin{proof}
  Consider an arbitrary permutation $\pi$.  For
  part~\ref{thm:permutable-reduction-transitions}, we have to show
  that if $\conf \parstepsto \conf'$ then $\pi(\conf) \parstepsto
  \pi(\conf')$, and that if $\pi(\conf) \parstepsto \pi(\conf')$ then
  $\conf \parstepsto \conf'$.

  For the forward direction of
  part~\ref{thm:permutable-reduction-transitions}, suppose $\conf
  \parstepsto \conf'$.  We have to show that $\pi(\conf) \parstepsto
  \pi(\conf')$.  We proceed by cases on the rule by which $\conf$
  steps to $\conf'$.

  \begin{itemize}
    \item Case {\sc E-Beta}: $\conf =
      \config{S}{\app{(\lam{x}{e})}{v}}$, and $\conf' =
      \config{S}{\subst{e}{x}{v}}$.

      To show: $\pi(\config{S}{\app{(\lam{x}{e})}{v}}) \parstepsto
      \pi(\config{S}{\subst{e}{x}{v}})$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\conf) = \config{\pi(S)}{\app{\pi(\lam{x}{e})}{\pi(v)}}$,
      which, by Definition~\ref{def:lvars-permutation-expression}, is
      equal to $\config{\pi(S)}{\app{(\lam{x}{\pi(e)})}{\pi(v)}}$.

      By {\sc E-Beta},
      $\config{\pi(S)}{\app{(\lam{x}{\pi(e)})}{\pi(v)}}$ steps to
      $\config{\pi(S)}{\subst{\pi(e)}{x}{\pi(v)}}$.

      By Definition~\ref{def:lvars-permutation-expression},
      $\config{\pi(S)}{\subst{\pi(e)}{x}{\pi(v)}}$ is equal to
      $\config{\pi(S)}{\pi(\subst{e}{x}{v})}$.

      Hence $\config{\pi(S)}{\app{(\lam{x}{\pi(e)})}{\pi(v)}}$ steps
      to $\config{\pi(S)}{\pi(\subst{e}{x}{v})}$, which is equal to
      $\pi(\config{S}{\subst{e}{x}{v}})$ by
      Definition~\ref{def:lvars-permutation-configuration}.  Hence the
      case is satisfied.

    \item Case {\sc E-New}: $\conf = \config{S}{\NEW}$, and $\conf' =
      \config{\extSRaw{S}{l}{\bot}}{l}$.

      To show: $\pi(\config{S}{\NEW}) \parstepsto
      \pi(\config{\extSRaw{S}{l}{\bot}}{l})$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\conf) = \config{\pi(S)}{\pi(\NEW)}$, which, by
      Definition~\ref{def:lvars-permutation-expression}, is equal to
      $\config{\pi(S)}{\NEW}$.

      By {\sc E-New}, $\config{\pi(S)}{\NEW}$ steps to
      $\config{\extSRaw{(\pi(S))}{l'}{\bot}}{l'}$, where $l' \notin
      \dom{\pi(S)}$.
      
      It remains to show that
      $\config{\extSRaw{(\pi(S))}{l'}{\bot}}{l'}$ is equal to
      $\pi(\config{\extSRaw{S}{l}{\bot}}{l})$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\config{\extSRaw{S}{l}{\bot}}{l})$ is equal to
      $\config{\pi(\extSRaw{S}{l}{\bot})}{\pi(l)}$, which is equal to
      $\config{\extSRaw{(\pi(S))}{\pi(l)}{\bot}}{\pi(l)}$.

      So, we have to show that
      $\config{\extSRaw{(\pi(S))}{l'}{\bot}}{l'}$ is equal to
      $\config{\extSRaw{(\pi(S))}{\pi(l)}{\bot}}{\pi(l)}$.  Since we
      know (from the side condition of {\sc E-New}) that $l \notin
      \dom{S}$, it follows that $\pi(l) \notin \pi(\dom{S})$.
      Therefore, in $\config{\extSRaw{(\pi(S))}{l'}{\bot}}{l'}$, we
      can $\alpha$-rename $l'$ to $\pi(l)$, and so the two
      configurations are equal and the case is satisfied.

    \item Case {\sc E-Put}: $\conf = \config{S}{\putexp{l}{d_2}}$, and
      $\conf' = \config{\extSRaw{S}{l}{\userlub{d_1}{d_2}}}{\unit}$.

      To show: $\pi(\config{S}{\putexp{l}{d_2}}) \parstepsto
      \pi(\config{\extSRaw{S}{l}{\userlub{d_1}{d_2}}}{\unit})$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\conf) = \config{\pi(S)}{\putexp{\pi(l)}{\pi(d_2)}}$,
      which, by Definition~\ref{def:lvars-permutation-expression}, is
      equal to $\config{\pi(S)}{\putexp{\pi(l)}{d_2}}$.

      By {\sc E-Put}, $\config{\pi(S)}{\putexp{\pi(l)}{d_2}}$ steps to
      $\config{\extSRaw{(\pi(S))}{\pi(l)}{\userlub{d_1}{d_2}}}{\unit}$,
      since $S(l) = (\pi(S))(\pi(l)) = d_1$.

      It remains to show that
      $\config{\extSRaw{(\pi(S))}{\pi(l)}{\userlub{d_1}{d_2}}}{\unit}$
      is equal to
      $\pi(\config{\extSRaw{S}{l}{\userlub{d_1}{d_2}}}{\unit})$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\config{\extSRaw{S}{l}{\userlub{d_1}{d_2}}}{\unit})$ is
      equal to
      $\config{\extSRaw{(\pi(S))}{\pi(l)}{\pi(\userlub{d_1}{d_2})}}{\pi(\unit)}$,
      which, by Definition~\ref{def:lvars-permutation-expression}, is
      equal to
      $\config{\extSRaw{(\pi(S))}{\pi(l)}{\userlub{d_1}{d_2}}}{\unit}$,
      and so the two configurations are equal and the case is
      satisfied.

    \item Case {\sc E-Put-Err}: $\conf = \config{S}{\putexp{l}{d_2}}$,
      and $\conf' = \error$.

      To show: $\pi(\config{S}{\putexp{l}{d_2}}) \parstepsto
      \pi(\error)$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\conf) = \config{\pi(S)}{\putexp{\pi(l)}{\pi(d_2)}}$,
      which, by Definition~\ref{def:lvars-permutation-expression}, is
      equal to $\config{\pi(S)}{\putexp{\pi(l)}{d_2}}$.

      By {\sc E-Put-Err}, $\config{\pi(S)}{\putexp{\pi(l)}{d_2}}$
      steps to $\error$, since $S(l) = (\pi(S))(\pi(l)) = d_1$.

      Since $\pi(\error) = \error$ by
      Definition~\ref{def:lvars-permutation-configuration}, the case
      is complete.

    \item Case {\sc E-Get}: $\conf = \config{S}{\getexp{l}{T}}$, and
      $\conf' = \config{S}{d_2}$.

      To show: $\pi(\config{S}{\getexp{l}{T}}) \parstepsto
      \pi(\config{S}{d_2})$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\conf) = \config{\pi(S)}{\getexp{\pi(l)}{\pi(T)}}$,
      which, by Definition~\ref{def:lvars-permutation-expression}, is
      equal to $\config{\pi(S)}{\getexp{\pi(l)}{T}}$.

      By {\sc E-Get}, $\config{\pi(S)}{\getexp{\pi(l)}{T}}$
      steps to $\config{\pi(S)}{d_2}$.

      By Definition~\ref{def:lvars-permutation-configuration},
      $\pi(\config{S}{d_2}) = \config{\pi(S)}{\pi(d_2)}$, which, by
      Definition~\ref{def:lvars-permutation-expression}, is equivalent
      to $\config{\pi(S)}{d_2}$.  Therefore the case is complete.
  \end{itemize}

  For the reverse direction of
  part~\ref{thm:permutable-reduction-transitions}, suppose $\pi(\conf)
  \parstepsto \pi(\conf')$.  We have to show that $\conf \parstepsto
  \conf'$.  We proceed by cases on the rule by which $\pi(\conf)$
  steps to $\pi(\conf')$.

  \begin{itemize}
    \item \TODO{Case {\sc E-Beta}}
    \item \TODO{Case {\sc E-New}}
    \item \TODO{Case {\sc E-Put}}
    \item \TODO{Case {\sc E-Put-Err}}
    \item \TODO{Case {\sc E-Get}}
  \end{itemize}

  For the forward direction of
  part~\ref{thm:permutable-context-transitions}, suppose $\conf
  \ctxstepsto \conf'$.  We have to show that $\pi(\conf) \ctxstepsto
  \pi(\conf')$.

  From the premise of {\sc E-Eval-Ctxt}, we have that $\conf
  \parstepsto \conf'$.  Hence from the forward direction of
  part~\ref{thm:permutable-reduction-transitions}, we have that
  $\pi(\conf) \parstepsto \pi(\conf')$.  Let $\conf = \config{S}{e}$
  and $\conf' = \config{S'}{e'}$.  By
  Definition~\ref{def:lvars-permutation-configuration}, we have that
  $\pi(\config{S}{e}) = \config{\pi(S)}{\pi(e)}$ and
  $\pi(\config{S'}{e'}) = \config{\pi(S')}{\pi(e')}$.  Hence
  $\config{\pi(S)}{\pi(e)} \parstepsto \config{\pi(S')}{\pi(e')}$.

  Therefore, by {\sc E-Eval-Ctxt}, we have that
  $\config{\pi(S)}{\E{\pi(e)}} \ctxstepsto
  \config{\pi(S')}{\E{\pi(e')}}$.

  \TODO{Finish this direction.}

  For the reverse direction of
  part~\ref{thm:permutable-context-transitions}, suppose $\pi(\conf)
  \ctxstepsto \pi(\conf')$.  We have to show that $\conf \ctxstepsto
  \conf'$.

  \TODO{Finish this direction.}
\end{proof}
